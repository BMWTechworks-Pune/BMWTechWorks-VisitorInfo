<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>BMWTechWorks Pune - Visitor Information</title>
<style>
   
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BMWTechWorks Pune â€“ Visitor Information & Meeting Rooms (Final)</title>
  
 <style>
    :root{ --accent:#007aff; --danger:#ff3b30; --bg:#f7f7f7; --card:#fff; --text:#111; --muted:#666; }
    html,body{ height:100%; }
    body{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--text); }

    /* Compact bold heading */
    header{ padding:12px 16px; background:#ffffff; border-bottom:1px solid #e6e6e6; }
    header h2{ margin:0; font-size:16px; font-weight:700; line-height:1.3; }

    /* Container */
    .container{ padding:0 12px 24px; }
    .grid{ display:grid; grid-template-columns: 2fr 1fr; gap:14px; }
    @media (max-width:1000px){ .grid{ grid-template-columns: 1fr; } }
    .card{ background:var(--card); border:1px solid #e6e6e6; border-radius:12px; padding:14px; margin:14px 0; }
    .content{ margin-top:8px; }
    .muted{ color:var(--muted); }

    /* Zoom wrap */
    .zoom-wrap{ position:relative; overflow:hidden; border-radius:12px; background:#fff; }
    .zoom-inner{ display:block; width:100%; height:auto; user-select:none; pointer-events:none; }
    .zoom-hint{ position:absolute; left:12px; bottom:12px; background:rgba(255,255,255,0.85); color:#111; padding:6px 10px; border-radius:8px; font-size:12px; }

    /* Tools */
    .tools{ display:flex; flex-wrap:wrap; gap:6px; margin:10px 0; }
    .btn{ font-size:16px; font-weight:600; padding:8px 14px; border:1px solid #d0d0d0; border-radius:8px; background:#fff; cursor:pointer; }
    .btn.primary{ border-color:var(--accent); color:#fff; background:var(--accent); }

    /* Controls bar as compact card */
    .title{ font-size:16px; font-weight:700; }
    .controls{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-top:10px; }
    .controls label{ font-size:14px; }
    .controls select, .controls input[type="range"]{ height:32px; }

    /* Canvas and overlay */
    #canvasWrap{ position:relative; border:1px solid #e6e6e6; border-radius:12px; overflow:hidden; background:#fff; }
    #floor{ display:block; width:100%; height:auto; margin:0; background:transparent; }
    #overlay{ position:absolute; inset:0; width:100%; height:100%; }

    /* Legend */
    .legend{ margin-top:10px; }
    .row{ display:flex; gap:8px; align-items:center; }
    .swatch{ width:18px; height:4px; background:#ff3b30; border-radius:2px; }

    /* Fix extra whitespace/gaps under images and banners */
    img{ vertical-align:middle; }
    .banner{ background:#eef4ff; border:1px solid #dbe6ff; border-radius:8px; padding:8px 10px; margin:10px 0; }
    .audio-bar{ background:#fafafa; border:1px solid #eee; border-radius:8px; padding:8px 10px; margin:10px 0; }

    /* Aside visuals */
    .img-list{ display:grid; grid-template-columns: 1fr; gap:10px; }
    .img-item img{ display:block; width:100%; height:auto; border-radius:8px; background:transparent; }
     
      /* Plan area */
    #planWrap{ position:relative; background:#fff; border:1px solid #e6e6e6; border-radius:12px; overflow:hidden; }
    #planLayer{ position:relative; transform-origin: 0 0; touch-action: none; }
    #planImg{ display:block; width:100%; height:auto; user-select:none; pointer-events:none; }
    /* Optional overlay kept for future use, no drawing now */
    #routeSvg{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; }

    /* Prevent stray backgrounds */
    .no-bg{ background: none !important; }

    /* Toolbar buttons: readable */
    .toolbar{ display:flex; flex-wrap:wrap; gap:6px; margin:8px 0; }
    .toolbar button{ font-size:16px; font-weight:600; padding:8px 14px; border:1px solid #d0d0d0; border-radius:8px; background:#fff; cursor:pointer; }
    .toolbar button.primary{ border-color: var(--accent); color:#fff; background:var(--accent); }

    .card h3{ font-size:16px; font-weight:700; margin:0 0 8px 0; }
    .card h4{ font-size:14px; font-weight:700; margin:0 0 6px 0; }

    #routeSteps{ margin-top:8px; }
    #routeSteps li{ margin:4px 0; }

    /* Image strip for room photos: remove extra white space */
    .imgStrip{ margin:8px 0 8px 0; padding:0; background:none; border:none; }
    .imgRow{ display:flex; gap:8px; flex-wrap:wrap; align-items:flex-start; }
    .imgWrap{ flex:1 1 320px; background:none; border:none; margin:0; padding:0; line-height:0; }
    .imgWrap img{ display:block; width:100%; height:auto; margin:0; border-radius:8px; background:transparent; }
    img{ vertical-align:middle; }
    .tight p{ margin:4px 0; }

    /* Tables */
    table{ width:100%; border-collapse:collapse; }
    th, td{ border:1px solid #ddd; padding:8px; text-align:left; }
    th{ background:#fafafa; }

    a{ color:#0a84ff; text-decoration:none; }
    a:hover{ text-decoration:underline; }
    
    footer{ margin-top:10px; color:#444; }
  </style>

<script>
    function toggleLanguage(lang) {
        document.querySelector('.english').style.display = lang === 'en' ? 'block' : 'none';
        document.querySelector('.german').style.display = lang === 'de' ? 'block' : 'none';
    }
</script>
</head>
<body>
<header>BMWTechWorks Pune - Visitor Information</header>
<div class='container'>
    <div style='text-align:center;'>
        <button class='toggle-btn' onclick="toggleLanguage('en')">English</button>
        <button class='toggle-btn' onclick="toggleLanguage('de')">Deutsch</button>
    </div>

Â       Â  <div class='english'>
Â  Â  Â  Â 
        <div class='english'>
        <h2>Quick Links</h2>
        <div class='links'>
            <a href='https://www.olacabs.com/' target='_blank'>Ola</a>
            <a href='https://www.uber.com/in/en/' target='_blank'>Uber</a>
            <a href='https://www.zomato.com/' target='_blank'>Zomato</a>
            <a href='https://www.swiggy.com/' target='_blank'>Swiggy</a>
            <a href='https://www.xe.com/currencyconverter/' target='_blank'>INR to EUR Converter</a>
            <a href='https://www.tripadvisor.in/Attractions-g297654-Activities-Pune_Maharashtra.html' target='_blank'>Local Sightseeing</a>
        </div>




        <h2>Company Info</h2>
        <p>BMWTechWorks India official site: <a href='https://www.bmwgroup.com/en.html' target='_blank'>Visit Website</a></p> 
        <p>LinkedIn: <a href='https://www.linkedin.com/company/bmwgroup/' target='_blank'>BMWTechWorks India LinkedIn</a></p>

        <h2>Emergency Contacts</h2>
        <p>Reception: +91-XXXXXXXXXX</p>
        <p>Ambulance: 108</p>
        <p>Emergency Facility Contact: +91-9769317569</p>
         <p><strong>Emergency FirstAid & Restroom:</strong> Floor No. 6 | <strong> Parking:</strong> Floor No. 3 | <strong>General Canteen:</strong> Terrace</p>

        <h2>Company Layout & Location</h2>
        <p>Address: BMWTechWorks India, 14 Offices, 1st Floor, Amar Tech Park, Balewadi, Pune, Maharashtra 411045</p>
        <a href='https://maps.app.goo.gl/BYkbvW1AjfjMWCiy6?g_st=ipc' target='_blank'>View on Google Maps</a> 

        Â Â   <h2>Nearby Emergency</h2>
Â  Â  Â  Â  <table>
Â  Â  Â  Â  Â  Â  <tr><th>Category</th><th>Name & Details</th><th>Google Map Link</th></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Hospital</td><td>Jupiter Hospital, Baner 1.5 km â€“ Multispeciality, 24x7 Emergency</td><td><a href='https://maps.app.goo.gl/cMBfuzuQExXohu8VA?g_st=ipc' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Hospital</td><td>Accord Hospital, Baner 2 km â€“ Multispeciality</td><td><a href='https://maps.app.goo.gl/Nes49fGqayziF9BN9?g_st=ipc' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Hospital</td><td>Ashwini Hospital, Balewadi 1.2 km â€“ General Clinic & OPD</td><td><a href='https://maps.app.goo.gl/SN7As6kyDPkvMz366?g_st=ipc' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Ambulance</td><td>Jupiter Hospital Ambulance 24x7 Ambulance â€“ 020 2799 2799</td><td><a href='https://maps.app.goo.gl/6h8X9kYvZr2JupiterHospital' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Ambulance</td><td>Mai Ambulance Services Local Ambulance â€“ Fast service</td><td><a href='https://maps.app.goo.gl/MaiAmbulanceLink' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Ambulance</td><td>Nucare Ambulance Contact â€“ 90966 67656</td><td><a href='https://maps.app.goo.gl/NucareAmbulanceLink' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Hotel</td><td>Holiday Inn Express Hinjewadi 3-star hotel near Balewadi</td><td><a href='https://maps.app.goo.gl/aPHsvdNCU1czoet37?g_st=ipc' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Hotel</td><td>The Orchid Hotel 4-star hotel, Balewadi Stadium</td><td><a href='https://maps.app.goo.gl/3GcSzVeJBFFRULc26?g_st=ipc' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  Â  Â  <tr><td>Hotel</td><td>Sadanand Regency Budget hotel near Balewadi</td><td><a href='https://maps.app.goo.gl/EePcq8Ej3w6jnXyN9?g_st=ipc' target='_blank'>View</a></td></tr>
Â  Â  Â  Â  </table>

        <h2>Basic German to English Phrases</h2>
        <table>
            <tr><th>German</th><th>English</th></tr>
            <tr><td>Hallo</td><td>Hello / Namaste</td></tr>
            <tr><td>Ich mÃ¶chte zu diesem Ort gehen</td><td>I want to go to this place</td></tr>
            <tr><td>Wie viel kostet das?</td><td>How much money?</td></tr>
            <tr><td>Danke</td><td>Thanks</td></tr>
            <tr><td>Ich mÃ¶chte das</td><td>I want this</td></tr>
            <tr><td>Guten Morgen</td><td>Good Morning</td></tr>
            <tr><td>Gute Nacht</td><td>Good Night</td></tr>
            <tr><td>Wo ist die Toilette?</td><td>Where is the restroom?</td></tr>
            <tr><td>KÃ¶nnen Sie mir helfen?</td><td>Can you help me?</td></tr>
            <tr><td>Ich brauche Wasser</td><td>I need water</td></tr>
        </table>
    </div>
</div>
</body>
</html>

<!-- New Sections Added -->
<hr>
<h2 id='vms'>Visitor Management System (VMS)</h2>
<p>Employees can enter ATP by showing their Company ID Card at the entrance.<br>
To enter Amar Tech Park (ATP), any visitor needs a VMS Pass (Visitor Management System Pass).<br>
<b>Who is a visitor?</b> Any person who is not a BTI employee.<br>
Create a VMS pass for expected visitor by clicking on <a href='#'>Prescheduler</a>.<br>
User ID: Facilities@bmwtechworks.in (For password, please connect with facilities).</p>

<h2 id='visitor-protocol'>Visitor Entry Protocol</h2>
<ul>
<li>All visitors must report to the reception desk on the 1st floor upon arrival.</li>
<li>Enter name, time of arrival, and purpose of visit in the visitor log.</li>
<li>Meetings should be conducted in designated areas: Visitor Room or Training Room.</li>
<li>For long meetings: Host must pre-book the meeting room and escort the visitor.</li>
<li>Visitors are not permitted to move around unaccompanied. Strict action will be taken against the host if violated.</li>
</ul>

<h2 id='parking'>Parking Guidelines</h2>
<ul>
<li>Parking is strictly first-come, first-served.</li>
<li>60 slots allocated for employees at P3 and P1 levels.</li>
<li>No common parking for external visitors/vendors. They must arrange parking outside ATP premises.</li>
</ul>

<h2 id='employee-entry'>Employee Entry & Exit</h2>
<ul>
<li>Employees can use both sides of the lift for entry and exit.</li>
<li>Always wear and display your ID card.</li>
<li>Swipe your access card while entering and exiting.</li>
<li>Tailgating is strictly prohibited and considered a security violation.</li>
</ul>

 
<!-- ===== BTI Pune â€“ Visitor Information: Exit Plan + Guidance ===== -->
<header>
  <h2>Exit Plan (Zoom â€¢ Pan â€¢ Fullscreen)</h2>
</header>

<div class="container">
  <div class="grid">
    <section class="card">
      <h2>Exit Plan (Zoom â€¢ Pan â€¢ Fullscreen)</h2>
      <div class="content">
        <!-- Map: zoom/pan wrapper -->
        <div class="zoom-wrap" id="zoomWrap" style="position:relative; overflow:hidden; border:1px solid #d8def0; border-radius:6px;">
          <!-- Optional overlay holder (SVG will be injected here if you add routes later) -->
          <!-- <svg id="routeOverlay" style="position:absolute; inset:0; pointer-events:none;"></svg> -->
          <img id="zoomImg" class="zoom-inner" src="r1.png" alt="BTI Pune Exit Plan"
               style="display:block; width:100%; transform-origin:0 0; user-select:nonepx;">
          <button class="btn" id="btnSpeak">ğŸ”Š Play Audio Guidance</button>
          <button class="btn" id="btnStop">â¹ Stop</button>
          <button class="btn" id="btnReset">â†º Reset View</button>
          <button class="btn" id="btnZoomIn">â• Zoom In</button>
          <button class="btn" id="btnZoomOut">â– Zoom Out</button>
          <button class="btn" id="btnFullscreen">â›¶ Fullscreen</button>
        </div>

        <p class="muted" style="margin-top:8px">Best experienced on Chrome/Edge. Use headphones in open areas.</p>

        <!-- Exit Guidance header controls -->
        <header style="margin-top:10px;">
          <div class="title" style="font-weight:600;">BTI Pune â€¢ Exit Guidance</div>
          <div class="controls" style="display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
            <label for="exitSelect">Exit:</label>
            <select id="exitSelect">
            
              <option value="EXIT1">EXIT1</option>
              <option value="EXIT2">EXIT2</option>
              <option value="EXIT3">EXIT3</option>
              <option value="EXIT4">EXIT4</option>
              <option value="EXIT5">EXIT5</option>
            </select>

            <label for="langSelect">Lang:</label>
            <select id="langSelect">
              <option value="en">EN</option>
              <option value="de">DE</option>
            </select>

            <button class="btn" id="play">Play</button>
            <button class="btn" id="replay">Replay</button>
            <button class="btn" id="mute">Mute</button>

           

            <!-- Optional: second set of zoom buttons (header block) -->
            <button class="btn" id="zoomOut">âˆ’</button>
            <button class="btn" id="zoomIn">+</button>
            <button class="btn" id="resetView">Reset</button>
          </div>
        </header>

        <!-- Guidance text display -->
        <div id="routeText" class="routeText" aria-live="polite"
             style="margin:8px 0; padding:8px; background:#f6f7fb; border:1px solid #d8def0; border-radius:6px;">
          Select an exit to see guidance.
        </div>

        <!-- Hidden audio element driven by the controls -->
        <audio id="routeAudio" preload="auto" style="display:none;"></audio>

        <!-- Optional: Graceful message if JS is disabled -->
        <noscript>
          <div style="padding:12px;color:#e11d48;">
            JavaScript is required for interactive routes and audio guidance.
          </div>
        </noscript>
      </div>
    </section>

   Â <aside class="card">
Â  Â  Â  Â  <h2>Quick References & QR</h2>
Â  Â  Â  Â  <div class="content">
Â  Â  Â  Â  Â  <div class="img-list">
Â  Â  Â  Â  Â  Â  <div class="img-item">
Â  Â  Â  Â  Â  Â  Â  <img src="r5.png" alt="Lanyard Types" />
Â  Â  Â  Â  Â  Â  Â  <p class="muted">ID lanyards: Employee â€¢ Contractor â€¢ Visitor â€¢ BMW Employee</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="img-item">
Â  Â  Â  Â  Â  Â  Â  <img src="r3.png" alt="Access Zones" />
Â  Â  Â  Â  Â  Â  Â  <p class="muted">Access policy map: Aâ€“G zones with restrictions and photography notes.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <hr style="margin:16px 0; border-color:#1f3f74"/>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>
  </div>
</div>

<!-- ===== Logic: Zoom/Pan + Audio/TTS + Reset ===== -->
<script>
/* ===================== DATA: paths & texts ===================== */
/* Normalized waypoints [x,y] in 0..1 relative to r1.png. 
   âš ï¸ Placeholder paths â€” tune points to match the red/green arrows on your map. */
const exitRoutePaths = {
  EXIT1: [[0.52,0.36],[0.47,0.36],[0.40,0.36],[0.34,0.28],[0.20,0.20],[0.14,0.18]], // to Exit 1 (approx)
  EXIT2: [[0.52,0.36],[0.47,0.36],[0.41,0.42],[0.30,0.55],[0.18,0.72],[0.09,0.84]], // to Exit 2 (approx)
  EXIT3: [[0.52,0.36],[0.56,0.44],[0.55,0.54],[0.48,0.60],[0.43,0.64],[0.38,0.70]], // to Exit 3 (approx)
  EXIT4: [[0.52,0.36],[0.58,0.36],[0.65,0.38],[0.72,0.46],[0.76,0.54],[0.80,0.60]], // to Exit 4 (approx)
  EXIT5: [[0.52,0.36],[0.60,0.30],[0.68,0.28],[0.75,0.26],[0.80,0.24],[0.86,0.22]]  // to Exit 5 (approx)
};
/* Guidance text (edit to match r1.png labels precisely) */
const exitRouteText = {
  en: {
    EXIT1: ['From YOU ARE HERE, move left along the corridor','Turn left near pantry','Follow green arrows to EXIT 1 staircase'],
    EXIT2: ['From YOU ARE HERE, proceed left','Continue past labs','Follow signs to EXIT 2'],
    EXIT3: ['From YOU ARE HERE, proceed slightly right','Head towards the central corridor','Follow signs to EXIT 3'],
    EXIT4: ['From YOU ARE HERE, go right','Turn right near meeting rooms','Follow green markings to EXIT 4'],
    EXIT5: ['From YOU ARE HERE, head to the upper corridor','Continue right','Reach EXIT 5 near the top section']
  },
  de: {
    EXIT1: ['Von HIER aus nach links zum Flur','Links bei der Pantry abbiegen','Den grÃ¼nen Pfeilen zu EXIT 1 folgen'],
    EXIT2: ['Von HIER nach links gehen','An den LaborrÃ¤umen vorbei','Den Schildern zu EXIT 2 folgen'],
    EXIT3: ['Von HIER leicht rechts gehen','Zum Hauptflur laufen','Den Schildern zu EXIT 3 folgen'],
    EXIT4: ['Von HIER nach rechts gehen','Rechts bei den BesprechungsrÃ¤umen abbiegen','Den grÃ¼nen Markierungen zu EXIT 4 folgen'],
    EXIT5: ['Von HIER zum oberen Flur gehen','Nach rechts weiterlaufen','EXIT 5 im oberen Bereich erreichen']
  }
};

/* ===================== PAN / ZOOM (same feel as room finder) ===================== */
const exitLayer = document.getElementById('exitPlanLayer');
const exitSvg   = document.getElementById('exitRouteSvg');
const exitImg   = document.getElementById('exitPlanImg');

let exitScale = 1, exitTx = 0, exitTy = 0;
let exitDragging = false, exPx = 0, exPy = 0;

function exitApply(){ exitLayer.style.transform = `translate(${exitTx}px, ${exitTy}px) scale(${exitScale})`; }
exitApply();

document.getElementById('exitZoomIn').onclick = () => { exitScale = Math.min(4, exitScale + 0.15); exitApply(); };
document.getElementById('exitZoomOut').onclick = () => { exitScale = Math.max(0.5, exitScale - 0.15); exitApply(); };

document.getElementById('exitReset').onclick = () => {
  exitScale = 1; exitTx = 0; exitTy = 0; exitApply();
  exitClearSvg(); exitSteps.innerHTML = ''; exitStopAudio(true); exitSel.value = '';
  exitAudioStatus.textContent = '';
};

exitLayer.addEventListener('pointerdown', (e) => {
  exitDragging = true; exPx = e.clientX; exPy = e.clientY; exitLayer.setPointerCapture(e.pointerId);
});
exitLayer.addEventListener('pointermove', (e) => {
  if (!exitDragging) return;
  const dx = e.clientX - exPx, dy = e.clientY - exPy;
  exitTx += dx; exitTy += dy; exPx = e.clientX; exPy = e.clientY; exitApply();
});
exitLayer.addEventListener('pointerup', () => exitDragging = false);

/* ===================== OVERLAY DRAWING ===================== */
function exitClearSvg(){ if (exitSvg) exitSvg.innerHTML = ''; }

function drawExitRoute(pointsNorm, color='#e11d48'){ // red path by default
  exitClearSvg();
  if (!pointsNorm || pointsNorm.length === 0) return;
  // Convert normalized 0..1 coords to viewBox (0..1000)
  const pts = pointsNorm.map(([x,y]) => `${x*1000},${y*1000}`).join(' ');
  const poly = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
  poly.setAttribute('points', pts);
  poly.setAttribute('fill', 'none');
  poly.setAttribute('stroke', color);
  poly.setAttribute('stroke-width', '6');
  poly.setAttribute('stroke-linecap', 'round');
  poly.setAttribute('stroke-linejoin', 'round');
  exitSvg.appendChild(poly);

  // Waypoint circles
  pointsNorm.forEach(([x,y], idx) => {
    const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    c.setAttribute('cx', x*1000);
    c.setAttribute('cy', y*1000);
    c.setAttribute('r', idx === 0 ? 10 : 6); // larger at start (YOU ARE HERE)
    c.setAttribute('fill', idx === 0 ? '#f59e0b' : '#1f3f74');
    exitSvg.appendChild(c);
  });
}

/* ===================== SELECTION + LANGUAGE ===================== */
const exitSel       = document.getElementById('exitSel');
const exitSteps     = document.getElementById('exitRouteSteps');
const exitAudio     = document.getElementById('exitAudio');
const exitPlay      = document.getElementById('exitPlayAudio');
const exitStop      = document.getElementById('exitStopAudio');
const exitVolume    = document.getElementById('exitVolume');
const exitAudioStatus = document.getElementById('exitAudioStatus');

let exitLang = (new URLSearchParams(location.search)).get('lang') || 'en';

function selectExit(exitId){
  if (!exitId) { exitSteps.innerHTML = ''; exitClearSvg(); exitStopAudio(true); return; }
  exitSel.value = exitId;
  // Text
  const lines = (exitRouteText[exitLang] && exitRouteText[exitLang][exitId]) ? exitRouteText[exitLang][exitId] : [];
  exitSteps.innerHTML = '';
  lines.forEach(s => { const li = document.createElement('li'); li.textContent = s; exitSteps.appendChild(li); });
  // Overlay
  drawExitRoute(exitRoutePaths[exitId], '#16a34a'); // green route
  // Bind audio source (recorded âœ fallback TTS)
  bindRecordedAudio(exitId, exitLang);
  exitUpdateAudioStatus();
}

exitSel.addEventListener('change', () => selectExit(exitSel.value));
document.getElementById('exitLangToggle').onclick = () => {
  exitLang = (exitLang === 'en') ? 'de' : 'en';
  selectExit(exitSel.value);
};

/* ===================== AUDIO: recorded first, TTS fallback ===================== */
function audioCandidates(exitId, lang){
  return [
    `assets/audio/${exitId}/voice_${lang}.mp3`, // preferred (your structure)
    `assets/audio/${exitId}/${lang}.mp3`,       // fallback
    `assets/audio/${exitId}_${lang}.mp3`,       // fallback
    `assets/audio/${exitId}.mp3`                // single-file fallback
  ];
}
function bindRecordedAudio(exitId, lang){
  const list = audioCandidates(exitId, lang);
  let idx = 0;
  exitAudio.onerror = () => tryNext();
  function tryNext(){
    if (idx >= list.length) { exitAudio.removeAttribute('src'); return; }
    const src = list[idx++]; exitAudio.src = src; exitAudio.load();
  }
  tryNext();
}
function exitUpdateAudioStatus(){
  const hasSrc = !!exitAudio.getAttribute('src');
  exitAudioStatus.textContent = hasSrc ? 'Recorded audio available.' : 'No recording found â€” will use TTS.';
}
function exitStopAudio(silent=false){
  try { exitAudio.pause(); exitAudio.currentTime = 0; } catch {}
  if ('speechSynthesis' in window) window.speechSynthesis.cancel();
  if (!silent) exitAudioStatus.textContent = '';
}
exitVolume.addEventListener('input', () => {
  exitAudio.volume = parseFloat(exitVolume.value || '1');
});

// TTS helpers
let exitVoices = [];
function loadVoices(){ exitVoices = window.speechSynthesis.getVoices(); }
if ('speechSynthesis' in window) {
  loadVoices(); window.speechSynthesis.onvoiceschanged = loadVoices;
}
function pickExitVoice(langCode){
  const exact = exitVoices.find(v => v.lang.toLowerCase() === langCode.toLowerCase());
  if (exact) return exact;
  const prefix = langCode.split('-')[0];
  const starts = exitVoices.find(v => v.lang.toLowerCase().startsWith(prefix.toLowerCase()));
  return starts || exitVoices[0] || null;
}
function buildExitSpeech(exitId, lang){
  const lines = (exitRouteText[lang] && exitRouteText[lang][exitId]) ? exitRouteText[lang][exitId] : [];
  return lines.join('. ');
}

// Play: prefer recorded audio; if not, use TTS
exitPlay.addEventListener('click', () => {
  const exitId = exitSel.value;
  if (!exitId) { exitAudioStatus.textContent = 'Select an exit first.'; return; }
  const hasSrc = !!exitAudio.getAttribute('src');
  exitStopAudio(true);
  if (hasSrc) {
    exitAudio.volume = parseFloat(exitVolume.value || '1');
    exitAudio.play().then(() => { exitAudioStatus.textContent = 'Playing recorded audioâ€¦'; })
                    .catch(() => { exitAudioStatus.textContent = 'Could not play audio.'; });
  } else {
    if (!('speechSynthesis' in window)) { exitAudioStatus.textContent = 'TTS not supported in this browser.'; return; }
    const langCode = (exitLang === 'de') ? 'de-DE' : 'en-US';
    const voice = pickExitVoice(langCode);
    const utter = new SpeechSynthesisUtterance(buildExitSpeech(exitId, exitLang));
    if (voice) utter.voice = voice;
    utter.rate = 1.0; utter.pitch = 1.0;
    utter.onstart = () => { exitAudioStatus.textContent = `Speaking (${voice ? voice.lang : langCode})â€¦`; };
    utter.onend   = () => { exitAudioStatus.textContent = 'Done.'; setTimeout(() => exitAudioStatus.textContent = '', 800); };
    utter.onerror = () => { exitAudioStatus.textContent = 'Speech error. Try again.'; };
    window.speechSynthesis.speak(utter);
  }
});

// Stop
exitStop.addEventListener('click', () => exitStopAudio());

// Clear (text + audio + overlay only; keep zoom state)
document.getElementById('exitClear').onclick = () => {
  exitSteps.innerHTML = ''; exitClearSvg(); exitStopAudio(); exitAudioStatus.textContent = '';
};

/* ===================== Deep-link init: ?exit=EXIT3&lang=de ===================== */
(function initFromQuery(){
  const p = new URLSearchParams(location.search);
  const qExit = p.get('exit'); const qLang = p.get('lang');
  if (qLang && (qLang === 'en' || qLang === 'de')) exitLang = qLang;
  if (qExit && ['EXIT1','EXIT2','EXIT3','EXIT4','EXIT5'].includes(qExit)) {
    exitSel.value = qExit; selectExit(qExit);
  }
})();
</script>

 <header>
    <h2>BMWTechWorks Pune â€“ Meeting Rooms</h2>
  </header>

  <main class="grid">
    <section id="planWrap" class="card">
      <div id="planLayer">
        <img id="planImg" src="r2.png" alt="BTI Pune floor plan"/>
        <!-- Optional SVG overlay kept for future use; not drawing any route now -->
        <svg id="routeSvg" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>
      </div>
      <p class="muted">Key rooms: Success, Inspire, Joy, Debug, iDrive, Mâ€‘Mode, Drift, xDrive, Torque.</p>
      <p class="muted" style="margin:8px 0 0 0">Drag to pan; use +/âˆ’ to zoom.</p>
    </section>

    <section class="card">
      <div class="card">
        <h3>Room Route Finder</h3>
        <label for="roomSel">Choose Meeting room:</label>
        <div class="toolbar">
          <button id="zoomIn" title="Zoom in">ï¼‹</button>
          <button id="zoomOut" title="Zoom out">ï¼</button>
          <button id="reset" title="Reset view">Reset</button>
          <button id="clearRoute" class="primary" title="Clear text & audio">Clear</button>
          <button id="langToggle" title="Toggle language">EN / DE</button>
        </div>
        <select id="roomSel">
          <option value="">â€” Select â€”</option>
          <option>Success</option>
          <option>Inspire</option>
          <option>Joy</option>
          <option>Debug</option>
          <option>iDrive</option>
          <option>M-Mode</option>
          <option>Drift</option>
          <option>xDrive</option>
          <option>Torque</option>
        </select>
        <ol id="routeSteps" class="muted" style="margin-top:8px"></ol>
      </div>

      <div id="audioPanel" class="card">
        <h4>Audio Guidance (TTS)</h4>
        <div class="toolbar">
          <button id="playAudio">Play</button>
          <button id="stopAudio">Stop</button>
          <span id="audioStatus" class="muted"></span>
        </div>
        <p class="muted" style="margin-top:6px">Tap <strong>Play</strong> after selecting a room.</p>
      </div>
    </section>
  </main>

  <script>
    // Data
    const routePaths = {
      Success:[[0.120,0.550],[0.100,0.480],[0.080,0.360],[0.060,0.300]],
      Inspire:[[0.120,0.550],[0.100,0.480],[0.085,0.400]],
      Joy:[[0.120,0.550],[0.140,0.560]],
      Debug:[[0.120,0.550],[0.300,0.550],[0.410,0.520]],
      iDrive:[[0.120,0.550],[0.300,0.550],[0.530,0.540]],
      'M-Mode':[[0.120,0.550],[0.300,0.550],[0.640,0.560]],
      Drift:[[0.120,0.550],[0.300,0.550],[0.740,0.560],[0.800,0.560]],
      xDrive:[[0.120,0.550],[0.300,0.550],[0.820,0.550],[0.880,0.540]],
      Torque:[[0.120,0.550],[0.300,0.550],[0.860,0.540],[0.940,0.540]]
    };

    const routeText = {
      en: {
        Success: ['Reception â†’ left corridor', 'Proceed up to board room', 'Success (Board)'],
        Inspire: ['Reception â†’ left corridor', 'Training room next to Success'],
        Joy: ['Reception â†’ left corridor', 'Joy is near Visitor area'],
        Debug: ['Reception â†’ main corridor', 'Continue to middle section', 'Debug lab is at center'],
        iDrive: ['Reception â†’ main corridor', 'Pass Debug', 'iDrive opposite Debug'],
        'M-Mode': ['Reception â†’ main corridor', 'Turn right', 'Mâ€‘Mode corner room'],
        Drift: ['Reception â†’ main corridor', 'Turn right into side corridor â†’ Tâ€‘junction', 'Drift next to xDrive'],
        xDrive: ['Reception â†’ main corridor', 'Turn right into side corridor', 'xDrive near Torque'],
        Torque: ['Reception â†’ far right end', 'Opposite xDrive', 'Torque room']
      },
      de: {
        Success:['Empfang â†’ linker Flur','Bis zum Boardroom','Success (Board)'],
        Inspire:['Empfang â†’ linker Flur','Schulungsraum neben Success'],
        Joy:['Empfang â†’ linker Flur','Joy nahe Besucherbereich'],
        Debug:['Empfang â†’ Hauptflur','Weiter zum Mittelteil','Debugâ€‘Labor im Zentrum'],
        iDrive:['Empfang â†’ Hauptflur','An Debug vorbei','iDrive gegenÃ¼ber Debug'],
        'M-Mode':['Empfang â†’ Hauptflur','Nach rechts abbiegen','Mâ€‘Mode Eckraum'],
        Drift:['Empfang â†’ Hauptflur','Rechts in Seitenflur â†’ Tâ€‘Kreuzung','Drift neben xDrive'],
        xDrive:['Empfang â†’ Hauptflur','Rechts in Seitenflur','xDrive nahe Torque'],
        Torque:['Empfang â†’ ganz rechts','GegenÃ¼ber xDrive','Torqueâ€‘Raum']
      }
    };

    // Pan/zoom
    const layer = document.getElementById('planLayer');
    const svg = document.getElementById('routeSvg'); // present but unused for drawing
    let scale = 1, tx = 0, ty = 0; let dragging = false, px = 0, py = 0;
    function apply(){ layer.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`; }
    apply();
    document.getElementById('zoomIn').onclick = ()=>{ scale = Math.min(4, scale + 0.15); apply(); };
    document.getElementById('zoomOut').onclick = ()=>{ scale = Math.max(0.5, scale - 0.15); apply(); };

    // Reset: clear text + audio and reset view (+ empty dropdown)
    const sel = document.getElementById('roomSel');
    const steps = document.getElementById('routeSteps');

    document.getElementById('reset').onclick = ()=>{
      scale = 1; tx = 0; ty = 0; apply();
      clearSvg(); steps.innerHTML=''; stopTTS(); sel.value='';
    };

    layer.addEventListener('pointerdown', (e)=>{ dragging = true; px = e.clientX; py = e.clientY; layer.setPointerCapture(e.pointerId); });
    layer.addEventListener('pointermove', (e)=>{ if(!dragging) return; const dx = e.clientX - px; const dy = e.clientY - py; tx += dx; ty += dy; px = e.clientX; py = e.clientY; apply(); });
    layer.addEventListener('pointerup', ()=> dragging=false);

    // No route drawing
    function clearSvg(){ if(svg) svg.innerHTML=''; }
    function drawRoute(room){ clearSvg(); return; }

    // Selection + language (text + TTS only)
    let currentLang = (new URLSearchParams(location.search)).get('lang') || 'en';

    function selectRoom(room){
      if(!room){ steps.innerHTML=''; clearSvg(); stopTTS(); return; }
      sel.value = room;
      steps.innerHTML='';
      (routeText[currentLang][room]||[]).forEach(s=>{ const li=document.createElement('li'); li.textContent=s; steps.appendChild(li); });
      // drawRoute(room); // intentionally not drawing any route
      updateVoiceStatus();
    }

    sel.addEventListener('change', ()=> selectRoom(sel.value));
    document.getElementById('langToggle').onclick = ()=>{ currentLang = (currentLang==='en')?'de':'en'; selectRoom(sel.value); };

    // Audio via Web Speech API (TTS)
    const audioStatus = document.getElementById('audioStatus');
    let voices = []; function loadVoices(){ voices = window.speechSynthesis.getVoices(); }
    loadVoices(); window.speechSynthesis.onvoiceschanged = loadVoices;

    function pickVoice(langCode){
      const exact = voices.find(v=>v.lang.toLowerCase()===langCode.toLowerCase());
      if(exact) return exact;
      const prefix = langCode.split('-')[0];
      const starts = voices.find(v=>v.lang.toLowerCase().startsWith(prefix.toLowerCase()));
      if(starts) return starts;
      return voices[0] || null;
    }

    function buildSpeechText(room, lang){ const lines = routeText[lang][room] || []; return lines.join('. '); }

    let currentUtterance = null;
    function stopTTS(){ if(currentUtterance){ window.speechSynthesis.cancel(); currentUtterance = null; } else { window.speechSynthesis.cancel(); } audioStatus.textContent = ''; }

    function speakSteps(room, lang){
      stopTTS();
      if(!room){ audioStatus.textContent='Select a room first.'; return; }
      const text = buildSpeechText(room, lang);
      if(!text){ audioStatus.textContent = 'No audio text available.'; return; }
      const voice = pickVoice(lang==='de' ? 'de-DE' : 'en-US');
      const utter = new SpeechSynthesisUtterance(text);
      if(voice) utter.voice = voice;
      utter.rate = 1.0; utter.pitch = 1.0;
      utter.onstart = ()=>{ audioStatus.textContent = `Speaking (${(voice && voice.lang) || (lang==='de'?'de-DE':'en-US')})â€¦`; };
      utter.onend   = ()=>{ audioStatus.textContent = 'Done.'; setTimeout(()=> audioStatus.textContent='', 800); };
      utter.onerror = ()=>{ audioStatus.textContent = 'Speech error. Try again.'; };
      currentUtterance = utter;
      window.speechSynthesis.speak(utter);
    }

    document.getElementById('playAudio').onclick = ()=> speakSteps(sel.value, currentLang);
    document.getElementById('stopAudio').onclick = ()=> stopTTS();

    // Clear: text + audio (keeps zoom/pan)
    document.getElementById('clearRoute').onclick = ()=>{ clearSvg(); steps.innerHTML=''; stopTTS(); sel.value=''; };

    // Deep link (shows text + TTS only)
    const qs = new URLSearchParams(location.search);
    const initialRoom = qs.get('room');
    if(initialRoom && routeText.en[initialRoom]){ sel.value = initialRoom; selectRoom(initialRoom); }
  </script>
<h2 id='safety'>Safety & Emergency</h2>
<p>Emergency escape route layout is pasted in designated areas.<br>
<b>Emergency Response Team (ERT) Members:</b></p>
<ul>
<li>DPE: Yogesh Tambat, Zulqurnain Khan</li>
<li>Digital Company: Rishabh Kundal</li>
<li>Software Factory: Sandesh Gharal</li>
<li>Driving ECU: Vivek Patil, Ganesh Garg</li>
<li>SSP: Aniket Patil, Chahul Turkar</li>
<li>AIML & Infotainment: Pravinkumar Kale</li>
<li>Connected Vehicle: Rajiv Rengasamy</li>
</ul>

<h2 id='facility'>Facility Concerns & Reporting</h2>
<p>Email: Facilities@bmwtechworks.in for facility-related concerns and unsafe acts/conditions.</p>

<h2 id='social-media'>Social Media & Contact</h2>
<p>
<a href='https://www.linkedin.com'>LinkedIn</a> |
<a href='https://www.facebook.com'>Facebook</a> |
<a href='https://www.youtube.com'>YouTube</a><br>
Website: <a href='https://bmwtechworks.in'>bmwtechworks.in</a>
</p>

  
<footer style="text-align:center; padding:12px; color:var(--muted)">
  <div>Â© BTI Pune â€” Visitor Info.</div>
  <div>***Developed By BTI-Digital CAR - SPP Team***</div>
   <div style="font-weight:bold; color:green;">
  @Copyright BTI-Digital CAR PUNE-SPP Team - 2025</div>
</footer>
